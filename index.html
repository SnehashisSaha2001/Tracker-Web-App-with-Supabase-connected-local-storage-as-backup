<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tracker App</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet"/>
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    :root {
      --primary-color: #0e2a47;
      --accent-color: #00d4ff;
      --bg-gradient: linear-gradient(to bottom right, #0f2027, #203a43, #2c5364);
      --card-bg: #1e2e3e;
      --text-light: #f1f1f1;
    }
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      background: var(--bg-gradient);
      color: var(--text-light);
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    @media (min-width: 768px) {
      body {
        flex-direction: row;
      }
    }
    .sidebar {
      width: 100%;
      max-width: 220px;
      background: var(--primary-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px 10px;
    }
    .sidebar h2 {
      margin-bottom: 40px;
    }
    .sidebar button {
      width: 100%;
      background: var(--accent-color);
      color: #000;
      border: none;
      padding: 12px;
      margin: 6px 0;
      font-size: 15px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }
    .main-content {
      flex-grow: 1;
      padding: 30px;
      overflow-y: auto;
    }
    section {
      display: none;
    }
    section.active {
      display: block;
    }
    .card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #2b3d50;
      margin-top: 10px;
    }
    table, th, td {
      border: 1px solid #00d4ff;
    }
    th, td {
      padding: 10px;
      text-align: left;
    }
    input, textarea, select {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
      border: none;
      background: #324a5f;
      color: #fff;
    }
    button.submit {
      background: var(--accent-color);
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 10px;
    }
    .employee-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    .employee-actions button {
      background-color: #00d4ff;
      color: #000;
      font-weight: bold;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: #1e2e3e;
      padding: 30px;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
      position: relative;
    }
    .modal-content h3 {
      margin-top: 0;
    }
    .close-modal {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      cursor: pointer;
      color: var(--text-light);
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      color: var(--text-light);
      font-weight: 600;
    }
    .form-group select.form-control,
    .form-group input.form-control {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 6px;
      border: none;
      background: #324a5f;
      color: #fff;
    }
    #city .city-actions button {
      background-color: var(--accent-color);
      color: #000;
      font-weight: bold;
      border: none;
      padding: 10px 15px;
      border-radius: 6px;
      cursor: pointer;
      margin-right: 10px;
    }
    #city .city-actions button.add-city {
      background-color: #28a745;
      color: #fff;
    }
    #city .city-actions button.search-city {
      background-color: #007bff;
      color: #fff;
    }

    #profile form label {
      display: block;
      margin-top: 10px;
      margin-bottom: 5px;
      color: var(--text-light);
      font-weight: 600;
    }

    #profile form input[type="text"],
    #profile form input[type="email"],
    #profile form input[type="password"],
    #profile form input[type="file"] {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 6px;
      border: none;
      background: #324a5f;
      color: #fff;
    }

    #profile .password-input-container {
      position: relative;
      width: 100%;
    }

    #profile .password-input-container input {
      padding-right: 40px;
    }

    #profile .password-input-container .toggle-password {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: #aaa;
    }

    #profile button.signup-button {
      background-color: #28a745;
      color: #fff;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
      margin-top: 20px;
      font-size: 16px;
    }

    .profile-photo-container {
      margin-bottom: 20px;
      text-align: center;
    }

    #profile-preview {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid var(--accent-color);
      margin-bottom: 10px;
    }
    .sidebar .profile-photo {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--accent-color);
      margin-bottom: 10px;
    }
    .sidebar .profile-details {
      text-align: center;
      margin-bottom: 20px;
    }
    .sidebar .profile-details p {
      margin: 2px 0;
      font-size: 0.9em;
      color: var(--text-light);
    }

    #state .card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }
    #state .form-group input,
    #state .form-group select {
      background: #324a5f;
      color: #fff;
      border: none;
    }
    #state button[type="submit"] {
      background: #28a745;
      color: #fff;
    }
    #state button[type="button"] {
      background: #007bff;
      color: #fff;
    }
    #state table {
      background: #2b3d50;
    }
    #state table th {
      background: #324a5f;
      color: var(--text-light);
    }
    #state table,
    #state table th,
    #state table td {
      border: 1px solid #00d4ff;
    }

    #customAlertModal, #customConfirmModal {
        display: none;
        position: fixed;
        z-index: 1001;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.4);
        justify-content: center;
        align-items: center;
    }

    #customAlertModal .modal-content, #customConfirmModal .modal-content {
        background-color: #1e2e3e;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 300px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
    }

    #customAlertModal .modal-content button, #customConfirmModal .modal-content button {
        background-color: var(--accent-color);
        color: #000;
        padding: 10px 20px;
        margin: 5px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
    }

@media (max-width: 768px) {
  body {
    flex-direction: column;
  }

  .sidebar {
    max-width: 100%;
    width: 100%;
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: space-around;
    padding: 10px;
  }

  .sidebar h2 {
    width: 100%;
    text-align: center;
    margin-bottom: 10px;
  }

  .sidebar button {
    flex: 1 1 45%;
    margin: 5px;
  }

  .sidebar .profile-photo,
  .sidebar .profile-details {
    display: none;
  }

  .main-content {
    padding: 15px;
  }

  .card {
    padding: 15px;
  }

  table, thead, tbody, th, td, tr {
    display: block;
  }

  table {
    border: none;
  }

  table thead {
    display: none;
  }

  table tr {
    margin-bottom: 15px;
    border: 1px solid #00d4ff;
    border-radius: 8px;
    padding: 10px;
    background: #2b3d50;
  }

  table td {
    position: relative;
    padding-left: 50%;
    text-align: left;
  }

  table td::before {
    position: absolute;
    top: 10px;
    left: 10px;
    width: 45%;
    white-space: nowrap;
    font-weight: bold;
    color: var(--accent-color);
  }

  #daily-activity-table-body td:nth-of-type(1)::before { content: "Employee ID:"; }
  #daily-activity-table-body td:nth-of-type(2)::before { content: "Name:"; }
  #daily-activity-table-body td:nth-of-type(3)::before { content: "Type:"; }
  #daily-activity-table-body td:nth-of-type(4)::before { content: "Date & Time:"; }
  #daily-activity-table-body td:nth-of-type(5)::before { content: "Location:"; }
  #daily-activity-table-body td:nth-of-type(6)::before { content: "Latitude:"; }
  #daily-activity-table-body td:nth-of-type(7)::before { content: "Longitude:"; }
  #daily-activity-table-body td:nth-of-type(8)::before { content: "Map:"; }
  #daily-activity-table-body td:nth-of-type(9)::before { content: "Details:"; }


  #followup-table td:nth-of-type(1)::before { content: "Employee ID:"; }
  #followup-table td:nth-of-type(2)::before { content: "Name:"; }
  #followup-table td:nth-of-type(3)::before { content: "Subject:"; }
  #followup-table td:nth-of-type(4)::before { content: "Date & Time:"; }
  #followup-table td:nth-of-type(5)::before { content: "Note:"; }
  #followup-table td:nth-of-type(6)::before { content: "Actions:"; }

  #state-table td:nth-of-type(1)::before { content: "State:"; }
  #state-table td:nth-of-type(2)::before { content: "Actions:"; }

  #city-table td:nth-of-type(1)::before { content: "State:"; }
  #city-table td:nth-of-type(2)::before { content: "City:"; }
  #city-table td:nth-of-type(3)::before { content: "Actions:"; }

  #employee-details-table td:nth-of-type(1)::before { content: "Employee ID:"; }
  #employee-details-table td:nth-of-type(2)::before { content: "Name:"; }
  #employee-details-table td:nth-of-type(3)::before { content: "Mobile No:"; }
  #employee-details-table td:nth-of-type(4)::before { content: "Email:"; }
  #employee-details-table td:nth-of-type(5)::before { content: "Actions:"; }

  #admin-details-table td:nth-of-type(1)::before { content: "Employee ID:"; }
  #admin-details-table td:nth-of-type(2)::before { content: "Name:"; }
  #admin-details-table td:nth-of-type(3)::before { content: "Mobile No:"; }
  #admin-details-table td:nth-of-type(4)::before { content: "Email:"; }
  #admin-details-table td:nth-of-type(5)::before { content: "Actions:"; }

#daily-activity-table-body img {
  vertical-align: middle;
  margin-right: 5px;
}
}

.hidden {
  display: none !important;
}

</style>
</head>
<body>
  <div class="sidebar">
    <h2>🚀 Tracker</h2>
    <img id="sidebar-profile-photo" class="profile-photo hidden" src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/b480eacc-40ca-4251-4c52-b6c5587b3aa7.png" alt="Profile Photo">
    <div id="profile-details-container" class="profile-details hidden">
      <p id="sidebar-employee-name">Employee Name</p>
      <p id="sidebar-employee-id">EMP-ID</p>
    </div>
    <button onclick="showSection('dashboard')" id="dashboardBtn" class="hidden">Dashboard</button>
    <button onclick="showSection('daily-activity')" id="dailyActivityBtn" class="hidden">Daily Activity</button>
    <button onclick="showSection('followups')" id="followupsBtn" class="hidden">Follow Ups</button>
    <button onclick="showSection('profile')" id="profileBtn" class="hidden">User Profile</button>
    <button onclick="showSection('employee-management')" id="employeeManagementBtn" class="hidden">Employee Management</button>
    <button onclick="showSection('admin-profile')" id="adminProfileBtn" class="hidden">Admin Profile</button>
    <button onclick="confirmLogout()" id="logoutBtn" class="hidden">Logout</button>
    <button onclick="showSection('login')" id="loginBtn">Login</button>
  </div>

  <div class="main-content">
    <section id="login" class="active">
        <div class="card">
            <h2>Login</h2>
            <form id="login-form">
                <div class="form-group" id="employee-id-group">
                    <label for="login-employee-id">Employee ID</label>
                    <input type="text" id="login-employee-id" class="form-control" placeholder="Enter your Employee ID" required>
                </div>
                <div class="form-group" id="admin-username-group" style="display: none;">
                    <label for="login-admin-username">Admin Username</label>
                    <input type="text" id="login-admin-username" class="form-control" placeholder="Enter Admin Username (e.g., ADM-YourName)">
                </div>
                <div class="form-group" id="mobile-number-group">
                    <label for="login-mobile-number">Mobile Number</label>
                    <input type="tel" id="login-mobile-number" class="form-control" placeholder="Enter your mobile number" required>
                </div>
                <div class="form-group" id="login-password-group" style="display: none;">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" class="form-control" placeholder="Enter your password" required>
                </div>
                <div class="form-group">
                    <label for="login-role">Select Role</label>
                    <select id="login-role" class="form-control" onchange="togglePasswordField()" required>
                        <option value="">-- Select Role --</option>
                        <option value="employee">Employee</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>
                <button type="submit" class="submit">Login</button>
            </form>
        </div>
    </section>

    <section id="dashboard">
      <div class="card">
        <h2 id="dashboard-welcome-message">Dashboard</h2>
        <ul>
          <li><strong>Mark Attendance:</strong> Easily clock in and out with a single tap.</li>
          <li><strong>Daily Visit Records:</strong> Log your client or field visits.</li>
          <li><strong>Follow Ups:</strong> Manage daily follow-ups with reminders.</li>
        </ul>
      </div>
    </section>

    <section id="daily-activity">
      <div class="card">
        <h2>📅 DAILY ACTIVITY</h2>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <div>
                <label for="activity-date-filter">Date:</label>
                <input type="date" id="activity-date-filter" style="max-width: 150px;" onchange="loadDailyActivity()">
            </div>
            <div id="employee-filter-container" style="display:none;">
                <label for="activity-employee-filter">Employee:</label>
                <select id="activity-employee-filter" style="max-width: 150px;" onchange="loadDailyActivity()">
                    <!-- Employee IDs will be loaded here for admin -->
                </select>
            </div>
            <div>
                <label for="activity-search">🔍 Search:</label>
                <input type="text" id="activity-search" placeholder="Employee name / EmployeeId" style="max-width: 150px;" onkeyup="loadDailyActivity()">
            </div>
        </div>

        <div class="employee-actions">
          <button onclick="markCheckIn()" id="checkInBtn">Check In</button>
          <button onclick="markCheckOut()" id="checkOutBtn">Check Out</button>
          <button onclick="exportToExcel('daily-activity')">Export All</button>
        </div>

        <div id="location-tracking-status" style="margin: 10px 0; font-weight: bold;">
            📍 Location Status: <span id="location-status-text">Inactive</span>
        </div>
        <div id="current-location" style="margin-bottom: 20px;">
            <div style="display: flex; gap: 20px;">
                <div style="flex: 1;">
                    <strong>Address:</strong> <span id="current-address">Waiting for location...</span><br>
                    <strong>Latitude:</strong> <span id="latitude">N/A</span><br>
                    <strong>Longitude:</strong> <span id="longitude">N/A</span><br>
                    <strong>Accuracy:</strong> <span id="accuracy">N/A</span> meters
                </div>
                <div id="map-container" style="flex: 1; height: 200px; border: 1px solid #00d4ff;">
                    <div id="leaflet-map" style="height: 100%;"></div>
                </div>
            </div>
        </div>

        <h3>──────────────────── Merged Log Table ────────────────────</h3>
        <table>
          <thead>
            <tr>
              <th>Employee ID</th>
              <th>Name</th>
              <th>Type</th>
              <th>Date & Time</th>
              <th>Location</th>
              <th>Latitude</th>
              <th>Longitude</th>
              <th>Map</th>
              <th>Details</th>
            </tr>
          </thead>
          <tbody id="daily-activity-table-body">
          </tbody>
        </table>
      </div>
    </section>

    <section id="followups">
      <div class="card">
        <h2>Follow Ups</h2>
        <div class="employee-actions">
          <button onclick="addFollowUpEntry()">Add Follow-Up</button>
          <button onclick="exportToExcel('followups')">Export to Excel</button>
        </div>
        <form id="followup-form">
          <input type="text" id="followup-subject" placeholder="Subject / Client Name" required>
          <input type="datetime-local" id="followup-datetime" required>
          <textarea id="followup-note" placeholder="Reminder Note"></textarea>
          <button type="submit" class="submit">Save Follow-Up</button>
        </form>
        <table style="margin-top:20px">
          <thead>
            <tr>
              <th id="followup-employee-id-header" style="display:none;">Employee ID</th>
              <th id="followup-employee-name-header" style="display:none;">Name</th>
              <th>Subject</th>
              <th>Date & Time</th>
              <th>Note</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="followup-table">
          </tbody>
        </table>
      </div>
    </section>

    <section id="state">
      <div class="card">
        <h2>State Management</h2>
        <form id="state-form">
          <div class="form-group">
            <label for="state-name">State Name</label>
            <input type="text" id="state-name" placeholder="Enter State Name" required class="form-control">
          </div>
          <button type="submit" class="submit">Add State</button>
        </form>
        <button onclick="exportToExcel('state')" class="submit" style="margin-top: 10px;">Export to Excel</button>
        <input type="text" id="search-state" placeholder="Search State" class="form-control" style="margin-top: 20px;" onkeyup="searchState()">
        <table>
          <thead>
            <tr>
              <th>State</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="state-table">
          </tbody>
        </table>
      </div>
    </section>

    <section id="city">
      <div class="card">
        <h2>City Management</h2>
        <form id="city-form">
          <div class="form-group">
            <label for="state-select">Select State</label>
            <select id="state-select" class="form-control" required>
              <option value="">-- Select State --</option>
            </select>
          </div>
          <div class="form-group">
            <label for="city-name">City Name</label>
            <input type="text" id="city-name" class="form-control" placeholder="Enter City Name" required>
          </div>
          <button type="submit" class="submit">Add City</button>
        </form>
        <button onclick="exportToExcel('city')" class="submit" style="margin-top: 10px;">Export to Excel</button>
        <input type="text" id="search-city" placeholder="Search City" class="form-control" style="margin-top: 20px;" onkeyup="searchCity()">
        <table style="margin-top:20px">
          <thead>
            <tr>
              <th>State</th>
              <th>City</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="city-table">
          </tbody>
        </table>
      </div>
    </section>

    <section id="profile">
      <div class="card">
        <h2>User Profile</h2>
        <form id="profile-form">
          <div class="profile-photo-container">
            <img id="profile-preview" src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/99a20669-ecb4-4325-a970-491b8dac39a9.png" alt="Profile Photo Preview">
            <label for="upload-photo" style="cursor: pointer; display: block; margin-top: 10px;">Upload Photo</label>
            <input type="file" id="upload-photo" accept="image/*" style="display: none;">
          </div>

          <label for="profile-name">Name</label>
          <input type="text" id="profile-name" placeholder="Enter Your Name">

          <label for="profile-employee-id">Employee ID</label>
          <input type="text" id="profile-employee-id" placeholder="Enter your Employee ID" readonly>

          <label for="profile-mobile-no">Mobile No</label>
          <input type="text" id="profile-mobile-no" placeholder="Enter your mobile no">

          <label for="profile-email-id">Email Id</label>
          <input type="email" id="profile-email-id" placeholder="Email">

          <label for="profile-password">Password</label>
          <div class="password-input-container">
            <input type="password" id="profile-password" placeholder="Password">
            <span class="toggle-password" onclick="togglePasswordVisibility()">&#128065;</span> </div>

          <button type="submit" class="signup-button">Save Profile</button>
        </form>
      </div>
    </section>

    <section id="admin-profile">
        <div class="card">
            <h2>Admin Profile Details</h2>
            <div class="employee-actions">
                <button onclick="openAddAdminModal()">Add Admin</button>
            </div>
            <table style="margin-top:20px">
                <thead>
                    <tr>
                        <th>Employee ID</th>
                        <th>Name</th>
                        <th>Mobile No</th>
                        <th>Email</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="admin-details-table">
                </tbody>
            </table>
        </div>
    </section>

    <section id="employee-management">
        <div class="card">
            <h2>Employee Details</h2>
            <div class="employee-actions">
                <button onclick="openAddEmployeeModal()">Add Employee</button>
                <button onclick="exportToExcel('employee-management')" class="submit">Export to Excel</button>
            </div>
            <table style="margin-top:20px">
                <thead>
                    <tr>
                        <th>Employee ID</th>
                        <th>Name</th>
                        <th>Mobile No</th>
                        <th>Email</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="employee-details-table">
                </tbody>
            </table>
        </div>
    </section>

  </div>

  <!-- Log Visit Modal (New/Modified) -->
  <div id="logVisitModal" class="modal">
    <div class="modal-content">
      <h3>📝 Log Visit?</h3>
      <form id="log-visit-form">
        <input type="hidden" id="log-visit-checkin-id">
        <label for="log-visit-client">Client Name:</label>
        <input type="text" id="log-visit-client" placeholder="Client/Company Name" required>
        <label for="log-visit-purpose">Visit Purpose:</label>
        <textarea type="text" id="log-visit-purpose" placeholder="Purpose / Notes" required></textarea>
        <label for="log-visit-location">Visit Location:</label>
        <input type="text" id="log-visit-location" placeholder="Visit Location" required>
        <div style="display: flex; justify-content: center; margin-top: 20px;">
            <button type="submit" class="submit">✔️ Submit Visit</button>
            <button type="button" class="submit" style="background-color: #f44336; margin-left: 10px;" onclick="skipVisit()">Skip Visit</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Custom Alert Modal -->
  <div id="customAlertModal" class="modal">
    <div class="modal-content">
      <p id="alertMessage"></p>
      <button onclick="closeAlert()">OK</button>
    </div>
  </div>

  <!-- Custom Confirm Modal -->
  <div id="customConfirmModal" class="modal">
    <div class="modal-content">
      <p id="confirmMessage"></p>
      <button id="confirmYes">Yes</button>
      <button id="confirmNo">No</button>
    </div>
  </div>

  <!-- Add Employee Modal -->
  <div id="addEmployeeModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeAddEmployeeModal()">&times;</span>
      <h3>Add New Employee</h3>
      <form id="add-employee-form">
        <div class="form-group">
          <label for="new-employee-id">Employee ID (SCS-XXXXXX)</label>
          <input type="text" id="new-employee-id" pattern="SCS-\d{5,6}" placeholder="SCS-12345 or SCS-123456" title="Format: SCS- followed by 5 or 6 digits" required>
        </div>
        <div class="form-group">
          <label for="new-employee-name">Full Name</label>
          <input type="text" id="new-employee-name" placeholder="John Doe" required>
        </div>
        <div class="form-group">
          <label for="new-employee-mobile">Mobile No</label>
          <input type="tel" id="new-employee-mobile" placeholder="9876543210" required>
        </div>
        <div class="form-group">
          <label for="new-employee-email">Email</label>
          <input type="email" id="new-employee-email" placeholder="john@example.com" required>
        </div>
        <div class="form-group">
          <label for="new-employee-password">Password</label>
          <input type="password" id="new-employee-password" placeholder="Set password" required>
        </div>
        <button type="submit" class="submit">Save Employee</button>
      </form>
    </div>
  </div>

  <!-- Add Admin Modal (New) -->
  <div id="addAdminModal" class="modal">
    <div class="modal-content">
      <span class="close-modal" onclick="closeAddAdminModal()">&times;</span>
      <h3>Add New Admin</h3>
      <form id="add-admin-form">
        <div class="form-group">
          <label for="new-admin-username">Admin Username (ADM-YourName)</label>
          <input type="text" id="new-admin-username" pattern="ADM-[A-Za-z\s]+" placeholder="ADM-JohnDoe" title="Format: ADM- followed by letters and spaces" required>
        </div>
        <div class="form-group">
          <label for="new-admin-name">Full Name</label>
          <input type="text" id="new-admin-name" placeholder="John Doe" required>
        </div>
        <div class="form-group">
          <label for="new-admin-mobile">Mobile No</label>
          <input type="tel" id="new-admin-mobile" placeholder="9876543210">
        </div>
        <div class="form-group">
          <label for="new-admin-email">Email</label>
          <input type="email" id="new-admin-email" placeholder="john@example.com">
        </div>
        <div class="form-group">
          <label for="new-admin-password">Password</label>
          <input type="password" id="new-admin-password" placeholder="Set password" required>
        </div>
        <button type="submit" class="submit">Save Admin</button>
      </form>
    </div>
  </div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
// ✅ Supabase Initialization
const supabase = window.supabase.createClient(
  'https://smoapnooceqbreclhrka.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNtb2Fwbm9vY2VxYnJlY2xocmthIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEzNTYxMjIsImV4cCI6MjA2NjkzMjEyMn0.FtXxRLdeBlSD5LZCsxMKUd0mFlS1HFcqA0g-ZG9suz8'
);

// New function to show/hide the password field based on role selection
function togglePasswordField() {
  const loginRole = document.getElementById('login-role').value;
  const passwordGroup = document.getElementById('login-password-group');
  if (loginRole === 'employee' || loginRole === 'admin') {
    passwordGroup.style.display = 'block';
  } else {
    passwordGroup.style.display = 'none';
  }
}

// Function to handle login success
function onLoginSuccess(role) {
  // Hide login-specific buttons
  document.getElementById('loginBtn').classList.add('hidden');

  // Show common buttons
  document.getElementById('dashboardBtn').classList.remove('hidden');
  document.getElementById('dailyActivityBtn').classList.remove('hidden');
  document.getElementById('followupsBtn').classList.remove('hidden');
  document.getElementById('profileBtn').classList.remove('hidden');
  document.getElementById('logoutBtn').classList.remove('hidden');

  // Show role-specific buttons
  if (role === 'admin') {
    document.getElementById('employeeManagementBtn').classList.remove('hidden');
    document.getElementById('adminProfileBtn').classList.remove('hidden');
  }

  // Show the user's profile info
  document.getElementById('sidebar-profile-photo').classList.remove('hidden');
  document.getElementById('profile-details-container').classList.remove('hidden');
  
  // Navigate to the dashboard
  showSection('dashboard');
}

// A stub for the showSection function to manage active sections
function showSection(sectionId) {
  // Hide all sections first
  document.querySelectorAll('section').forEach(section => {
    section.classList.remove('active');
  });

  // Show the requested section
  const activeSection = document.getElementById(sectionId);
  if (activeSection) {
    activeSection.classList.add('active');
  }
}

// ✅ 1. Check if Supabase is Online
async function isSupabaseOnline() {
  try {
    const { error } = await supabase.from("daily_activities").select("id").limit(1);
    return !error;
  } catch {
    return false;
  }
}

// ✅ 2. Insert a Check-in Activity with retry logic
async function insertCheckInActivity(activity) {
  const MAX_RETRIES = 3;
  let isOnline = false;

  for (let i = 0; i < MAX_RETRIES; i++) {
    if (await isSupabaseOnline()) {
      isOnline = true;
      break;
    }
    // Optional: wait a moment before retrying
    await new Promise(resolve => setTimeout(resolve, 1000));
  }

  if (isOnline) {
    const { error } = await supabase.from("daily_activities").insert(activity);
    if (error) {
      console.error("Insert error, saving locally:", error.message);
      saveActivityOffline(activity);
      alert("⚠️ Supabase error, saved locally.");
    } else {
      alert("✅ Check-in synced to Supabase.");
    }
  } else {
    saveActivityOffline(activity);
    alert("📴 Offline or server unreachable: check-in saved locally.");
  }
}

// ✅ 3. Save Activity Locally (Offline Mode)
function saveActivityOffline(activity) {
  const local = JSON.parse(localStorage.getItem("offline_activities") || "[]");
  local.push(activity);
  localStorage.setItem("offline_activities", JSON.stringify(local));
}

// ✅ 4. Sync Offline Activities to Supabase
async function syncOfflineActivities() {
  const online = await isSupabaseOnline();
  if (!online) return;

  const stored = JSON.parse(localStorage.getItem("offline_activities") || "[]");
  if (!stored.length) return;

  const { error } = await supabase.from("daily_activities").insert(stored);
  if (!error) {
    localStorage.removeItem("offline_activities");
    console.log("✅ Synced offline check-ins.");
  } else {
    console.error("❌ Failed syncing offline check-ins:", error.message);
  }
}
window.addEventListener("load", syncOfflineActivities);
window.addEventListener("online", syncOfflineActivities);

// ✅ Optional: Admin - Fetch All Activities
async function fetchAllActivitiesForAdmin() {
  const { data, error } = await supabase
    .from("daily_activities")
    .select("*")
    .order("timestamp", { ascending: false });

  if (error) {
    console.error("❌ Error fetching activities:", error.message);
    return;
  }

  renderActivities(data); // Implement this to display data
}

// Initial state on page load
document.addEventListener('DOMContentLoaded', () => {
    // Ensure only the login screen is visible
    document.querySelectorAll('section').forEach(section => {
        section.classList.remove('active');
    });
    document.getElementById('login').classList.add('active');

    // Add a class to all buttons and profile elements that should be hidden
    const sidebarElements = ['sidebar-profile-photo', 'profile-details-container', 'dashboardBtn', 'dailyActivityBtn', 'followupsBtn', 'profileBtn', 'employeeManagementBtn', 'adminProfileBtn', 'logoutBtn'];
    sidebarElements.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            element.classList.add('hidden');
        }
    });
});
</script>
</body>
</html>
